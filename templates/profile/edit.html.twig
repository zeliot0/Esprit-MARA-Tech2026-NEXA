{% extends 'base.html.twig' %}

{% block title %}Mon Profil • Aychek{% endblock %}

{% block body %}
<div class="container" style="padding-top: var(--space-2xl); padding-bottom: var(--space-2xl);">
    <div style="max-width: 900px; margin: 0 auto;">
        
        <div class="animate-up" style="margin-bottom: var(--space-xl);">
            <span class="page-label">Paramètres</span>
            <h1 class="h1-mega" style="font-size: 2.5rem;">Gestion du Profil</h1>
            <p class="p-lead">Personnalisez votre identité sur la plateforme Aychek.</p>
        </div>

        <div class="glass-panel animate-up delay-1" style="display: grid; grid-template-columns: 1fr 2fr; gap: 0; padding: 0; overflow: hidden; border-radius: var(--radius-2xl);">
            
            {# Left: Visual Profile #}
            <aside style="background: var(--bg-subtle); padding: var(--space-xl); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; text-align: center;">
                <div style="position: relative; margin-bottom: 24px;">
                    <div style="width: 160px; height: 160px; border-radius: 50%; overflow: hidden; background: var(--grad-premium); border: 4px solid var(--surface); box-shadow: var(--shadow-lg);">
                        {% if user.avatar %}
                            <img src="{{ asset('uploads/avatars/' ~ user.avatar) }}" alt="Avatar" style="width: 100%; height: 100%; object-fit: cover;">
                        {% else %}
                            <div style="width: 100%; height: 100%; display: grid; place-items: center; color: white; font-size: 3rem; font-weight: 800;">
                                {{ user.fullName|slice(0, 1)|upper }}
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <h3 style="font-weight: 800; font-size: 1.25rem; margin-bottom: 4px;">{{ user.fullName }}</h3>
                <p class="muted" style="font-size: 0.8rem; text-transform: uppercase; font-weight: 700; letter-spacing: 0.05em; color: var(--brand);">
                    {% if is_granted('ROLE_ADMIN') %}Administrateur{% elseif is_granted('ROLE_ASSOCIATION') %}Association{% else %}Donateur{% endif %}
                </p>
                
                <div style="margin-top: auto; padding-top: 24px; width: 100%; border-top: 1px solid var(--border);">
                    <div class="muted" style="font-size: 0.75rem; font-weight: 600;">Membre depuis</div>
                    <div style="font-weight: 700; font-size: 0.9rem;">{{ user.createdAt|date('M Y') }}</div>
                </div>
            </aside>

            {# Right: Form #}
            <section style="padding: var(--space-xl); background: var(--surface);">
                {{ form_start(form) }}
                    <div style="display: flex; flex-direction: column; gap: 24px;">
                        
                        <div>
                            <h4 style="font-weight: 800; font-size: 0.9rem; text-transform: uppercase; color: var(--text-soft); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                                <i class="fa-solid fa-user-pen"></i> Identité & Contact
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div class="form-field">
                                    {{ form_label(form.fullName, null, {'label_attr': {'class': 'form-label'}}) }}
                                    {{ form_widget(form.fullName, {'attr': {'class': 'form-input'}}) }}
                                    {{ form_errors(form.fullName) }}
                                </div>
                                <div class="form-field">
                                    {{ form_label(form.phone, null, {'label_attr': {'class': 'form-label'}}) }}
                                    {{ form_widget(form.phone, {'attr': {'class': 'form-input'}}) }}
                                    {{ form_errors(form.phone) }}
                                </div>
                            </div>
                            <div class="form-field" style="margin-top: 20px;">
                                {{ form_label(form.email, null, {'label_attr': {'class': 'form-label'}}) }}
                                {{ form_widget(form.email, {'attr': {'class': 'form-input', 'style': 'background-color: var(--bg-subtle); color: var(--muted); cursor: not-allowed;'}}) }}
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <h4 style="font-weight: 800; font-size: 0.9rem; text-transform: uppercase; color: var(--text-soft); margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                                <i class="fa-solid fa-image"></i> Avatar
                            </h4>
                            <div class="form-field">
                                <label class="form-label">Changer la photo de profil</label>
                                <div style="display: flex; align-items: center; gap: 16px;">
                                    <div class="file-input-wrapper" style="flex-grow: 1;">
                                        {{ form_widget(form.avatarFile, {'attr': {'style': 'display: none;', 'onchange': 'updateFileName(this)'}}) }}
                                        <button type="button" class="btn" style="width: 100%; justify-content: flex-start; background: var(--surface2); border: 1px dashed var(--border-rich);" onclick="document.getElementById('{{ form.avatarFile.vars.id }}').click()">
                                            <i class="fa-solid fa-cloud-arrow-up"></i> <span id="fileName">Choisir une image...</span>
                                        </button>
                                    </div>
                                </div>
                                {{ form_errors(form.avatarFile) }}
                                <p class="muted" style="font-size: 0.75rem; margin-top: 8px;">Format supportés: JPG, PNG, WEBP (Max 2Mo)</p>
                            </div>
                        </div>

                        <div style="margin-top: var(--space-lg); padding-top: var(--space-lg); border-top: 1px solid var(--border); display: flex; justify-content: flex-end;">
                            <button type="submit" class="btn btn-primary" style="padding: 12px 40px; border-radius: var(--radius-full); box-shadow: var(--shadow-lg);">
                                <i class="fa-solid fa-check"></i> Enregistrer les modifications
                            </button>
                        </div>
                    </div>
                {{ form_end(form) }}
            </section>
        </div>
    </div>
</div>

<script>
function updateFileName(input) {
    const name = input.files[0] ? input.files[0].name : 'Choisir une image...';
    document.getElementById('fileName').textContent = name;
}
</script>
{% endblock %}
