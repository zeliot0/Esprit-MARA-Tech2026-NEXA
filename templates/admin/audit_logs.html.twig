{% extends 'admin/base.html.twig' %}

{% block title %}Audit Logs | Aychek{% endblock %}
{% block page_title %}Audit Logs{% endblock %}

{% block body %}
<div class="glass-panel" style="padding: 24px; border-radius: var(--radius-xl); margin-bottom: 24px;">
    <div>
        <h3 style="font-weight: 800; margin-bottom: 4px;">Historique des Actions</h3>
        <p class="muted">Suivez toutes les modifications effectuées sur la plateforme.</p>
    </div>
</div>

<div class="table-container">
    <table class="admin-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Utilisateur</th>
                <th>Action</th>
                <th>Entité</th>
                <th>ID Entité</th>
                <th>Détails</th>
            </tr>
        </thead>
        <tbody>
            {% for log in logs %}
            <tr>
                <td style="font-size: 0.8rem;">{{ log.createdAt|date('d/m/Y H:i:s') }}</td>
                <td>
                    {% if log.user %}
                        <span style="font-weight: 700;">{{ log.user.fullName }}</span>
                    {% else %}
                        <span class="muted">Système</span>
                    {% endif %}
                </td>
                <td>
                    <span class="badge" style="background: var(--surface2); color: var(--text);">{{ log.action }}</span>
                </td>
                <td><span class="badge badge-info">{{ log.entityType }}</span></td>
                <td>#{{ log.entityId }}</td>
                <td>
                    {% if log.metaJson %}
                        <button class="btn btn-sm btn-ghost" onclick="showMeta({{ log.metaJson|json_encode }})">
                            <i class="fa-solid fa-code"></i>
                        </button>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center; padding: 48px; color: var(--muted);">Aucun log disponible.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Simple Modal for JSON -->
<div id="logModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px;">
    <div class="glass-panel" style="max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto; background: var(--surface);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="font-weight: 800;">Détails (JSON)</h3>
            <button class="btn btn-ghost" onclick="document.getElementById('logModal').style.display='none'"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <pre id="jsonContent" style="background: var(--bg-subtle); padding: 16px; border-radius: var(--radius-md); font-size: 0.85rem; overflow-x: auto; color: var(--text-soft);"></pre>
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script>
    function showMeta(json) {
        document.getElementById('jsonContent').textContent = JSON.stringify(json, null, 2);
        document.getElementById('logModal').style.display = 'flex';
    }
    
    window.onclick = function(event) {
        const modal = document.getElementById('logModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
{% endblock %}
