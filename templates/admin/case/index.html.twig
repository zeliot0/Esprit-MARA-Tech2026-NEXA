{% extends 'admin/base.html.twig' %}

{% block title %}Gestion des Appels | Sanad Admin{% endblock %}
{% block page_title %}Appels d'offres{% endblock %}

{% block body %}
<div class="glass-panel" style="padding: 0; overflow: hidden;">
    <div style="padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <h3 style="font-weight: 800; font-size: 1.1rem;">Liste des appels</h3>
        <a href="{{ path('admin_case_new') }}" class="btn btn-primary btn-sm">
            <i class="fa-solid fa-plus" style="margin-right: 8px;"></i> Lancer un appel
        </a>
    </div>
    <div class="table-container" style="margin-top: 0; border: none; border-radius: 0;">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Titre</th>
                    <th>Catégorie</th>
                    <th>Objectif</th>
                    <th>Collecté</th>
                    <th>Urgence</th>
                    <th>Statut</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for case in cases %}
                <tr>
                    <td>#{{ case.id }}</td>
                    <td style="font-weight: 600; color: var(--text);">{{ case.title }}</td>
                    <td><span class="badge badge-info">{{ case.category.name|default('N/A') }}</span></td>
                    <td>{{ case.targetAmount|number_format(2, ',', ' ') }} TND</td>
                    <td>
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <span>{{ case.currentAmount|number_format(2, ',', ' ') }} TND</span>
                            <div style="width: 80px; height: 6px; background: var(--surface2); border-radius: 3px; overflow: hidden;">
                                {% set progress = case.targetAmount > 0 ? (case.currentAmount / case.targetAmount * 100) : 0 %}
                                <div style="width: {{ progress }}%; height: 100%; background: var(--grad-premium);"></div>
                            </div>
                        </div>
                    </td>
                    <td>
                        {% if case.urgency == 'HIGH' %}
                            <span class="badge badge-danger">Haute</span>
                        {% elseif case.urgency == 'MEDIUM' %}
                            <span class="badge badge-warning">Moyenne</span>
                        {% else %}
                            <span class="badge badge-info">Basse</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if case.status == 'PUBLISHED' %}
                            <span class="badge badge-success">En ligne</span>
                        {% else %}
                            <span class="badge">{{ case.status }}</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        <div style="display: flex; gap: 8px; justify-content: flex-end;">
                            <a href="{{ path('admin_case_edit', {id: case.id}) }}" class="btn btn-sm" title="Modifier">
                                <i class="fa-regular fa-pen-to-square"></i>
                            </a>
                            <form method="post" action="{{ path('admin_case_delete', {id: case.id}) }}" onsubmit="return confirm('Supprimer cet appel ?');" style="display: inline-block;">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ case.id) }}">
                                <button class="btn btn-sm" style="color: #ef4444; border-color: transparent;">
                                    <i class="fa-regular fa-trash-can"></i>
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" style="text-align: center; padding: 48px; color: var(--muted);">Aucun appel d'offre trouvé.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
